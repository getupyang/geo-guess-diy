
# GeoGuesser - 产品需求文档 (PRD)

## 1. 产品概述
**GeoGuesser** 是一款基于地理位置的探索与猜谜游戏。用户通过上传照片创建挑战，或参与他人发起的挑战，根据图片中的视觉线索（如植被、建筑、路牌）在地图上猜测具体位置。

### 1.1 核心价值
- **探索欲**：足不出户，通过图片探索世界各地的角落。
- **社交互动**：创建谜题挑战好友，复盘对比各自的猜测结果。
- **轻量级**：Web 端即开即玩，无需下载 App。

## 2. 用户角色
- **出题者 (Creator)**：上传图片，设置目标地点，发布挑战。
- **猜题者 (Player)**：浏览挑战，通过地图交互进行猜测。

## 3. 功能模块

### 3.1 首页 (Home)
- **用户信息**：展示当前用户头像、昵称、ID。支持点击修改昵称。
- **开始挑战**：随机抽取一个用户未玩过的挑战。
- **创建挑战**：入口跳转至创建流程。
- **最近挑战**：展示最近游玩的 2 条记录（图片缩略图+地点+分数）。
- **历史记录**：点击“查看更多”进入完整历史列表。

### 3.2 创建挑战 (Create Mode)
1.  **图片上传**：支持本地上传（自动提取 EXIF GPS 信息）。
2.  **图片处理**：
    -   **压缩**：自动压缩至 1024px / 0.6 质量，保证加载速度。
    -   **打码**：支持“马赛克”涂抹功能，隐藏关键信息（如路牌文字），支持撤销。
3.  **位置设定**：
    -   自动读取 GPS（如有）。
    -   支持通过地图搜索地址（Geocoding）。
    -   支持在地图上拖拽修正位置。
    -   反显具体地理位置名称（如“北京市故宫博物院”）。
4.  **发布**：保存至云端数据库。 

### 3.3 游玩挑战 (Play Mode)
1.  **图片浏览**：全屏展示挑战图片，支持**双指缩放**、**双击放大**、**拖拽平移**查看细节。
2.  **地图猜测**：
    -   点击浮动按钮唤起地图。
    -   地图支持缩放、平移。
    -   用户点击选点，确认后提交。

### 3.4 结果复盘 (Review Mode)
1.  **结果可视化**：
    -   地图上同时显示：**正确答案**（旗帜）、**我的猜测**（头像+连线）、**其他玩家猜测**（头像+气泡）。
    -   点击右下角按钮可反复开关地图，查看图片细节。
2.  **数据展示**：
    -   顶部显示本次得分（0-5000）和**误差距离**（m/km）。
    -   **群体统计**：当参与玩家超过 2 人时，显示全服平均分和总挑战人数。
3.  **反馈机制**：
    -   **❤️ 点赞 (Like)**：用户可点击心形按钮为优质题目点赞。
    -   **计数逻辑**：点击点赞，再次点击取消点赞。旁边显示总获赞数（大于 0 时显示）。

## 4. 关键交互细节
- **地图防误触**：地图面板增加全屏透明遮罩，点击遮罩或关闭按钮才收起，防止误触。
- **手势支持**：移动端完美支持 Pinch-to-zoom 和 Touch 拖拽。
- **无缝衔接**：利用本地缓存，减少等待时间。

## 5. 性能指标
- **首屏加载**：< 1.5秒
- **图片加载**：< 300ms (基于 100KB 压缩图)
- **地图渲染**：无闪退，支持 ResizeObserver 响应式调整。

---

## 6. 集锦功能 (Collections)

### 6.1 概述与核心概念

集锦是一个由出题者策划的题目合集，旨在通过主题化内容和社交分享提升游戏粘性。

**三层内容体系：**
- **题目**：单张图片构成的一次猜位置挑战（即现有 Game）
- **集锦**：由出题者从自己发布的题目中策划的有序合集（1-10 道题）
- **广场**：所有公开集锦的发现入口（v1 按创建时间倒序）

**用户的四类内容列表：**
| 列表 | 内容说明 |
| :--- | :--- |
| 我做过的题 | 在单题模式下游玩过的历史记录 |
| 我发布的题 | 我上传并发布的单道题 |
| 我发布的集锦 | 我创建并发布的集锦列表 |
| 我做过的集锦 | 我参与并完成过的集锦列表 |

---

### 6.2 创建集锦

**入口：** 首页平铺展示，与"出一道题"并列。

**创建流程：**
1. 输入集锦名称（必填，最多 10 字）
2. 从"我发布的题"中选择图片，添加至集锦（参考微信发图交互）
   - 图片以方形缩略图展示，右上角有圆圈，点击后按顺序标记编号（第1题、第2题……）
   - 再次点击编号圆圈可取消选择，后续题目编号自动重排
   - 最少 1 道题，最多 10 道题；超过 10 道时弹出提示
   - **空状态**（用户尚未发布任何题目）：显示引导文案"你还没有出过题，先去出一道题吧 →"
3. 点击"发布"→ **直接跳转至该集锦的出题人视图**（不自动弹出分享，不做任何弹窗）

**约束规则：**
- 发布后不允许编辑内容或顺序
- v1 不支持删除集锦（避免历史答题数据处理复杂度）

---

### 6.3 集锦首页（三视图）

集锦首页 URL 唯一，系统根据当前用户身份自动切换视图。

#### 视图 A：出题人视图
- 集锦名称、题目数量（X 道题）
- 题目缩略图列表（供回顾内容顺序）
- 统计数据：
  - 完成人数
  - 平均总分
  - **每道题的平均得分**（帮助出题者了解哪道题最难/最有趣）
- [分享集锦] 按钮

#### 视图 B：未完成做题人视图
- 集锦名称、出题人昵称
- [开始答题] 按钮（首次进入）或 [继续答题] 按钮（有本地缓存进度时）
- [分享] 按钮

#### 视图 C：已完成做题人视图（同时承担完成汇总功能）
- 集锦名称、出题人昵称
- **你的得分**（大字突出展示）
- **排行榜**：
  - 展示字段：排名 + 昵称 + 总分（不显示头像）
  - 显示前 10 名，自己的行始终展示并高亮（即使排名 >10）
  - 同分时按完成时间早的排前
  - **冷启动文案**（仅 1 人完成时）："你是第一个完成这个集锦的人！快去分享，看看朋友能超过你吗？"
- [分享] 按钮

---

### 6.4 答题流程

**进入：** 点击"开始答题"或"继续答题"后进入。

#### 进度条
顶部展示点状进度，如 `● ● ◉ ○ ○`（已答=实心，当前=高亮，未答=空心），并显示"N / M 题"。

#### 题目已答过的处理（历史跳过模式）
若集锦中某道题用户曾在**单题模式**下答过，则：
- 显示"历史答题"卡片，提示"你之前答过这道题"
- 展示历史得分与误差距离（复用 guesses 表数据）
- 仅提供 [下一题] 按钮，不可重新作答
- 历史得分自动计入本次集锦总分

#### 正常答题（复用现有 Play + Review Mode 核心逻辑）
1. 图片全屏展示（支持缩放/平移）
2. 唤起地图，点击选点并提交
3. 进入题目结果页（显示单题得分、地图对比）
4. 点击"下一题"进入下一道
5. 最后一题结果页点击"完成" → 跳转至集锦首页（已完成视图 C）

#### 退出与进度保存
- 顶部提供退出按钮，点击后提示"进度已自动保存，下次可继续作答"
- 由于每道题在集锦中只能答一次（已答过的直接跳过），用户对"保存"的理解是自然的

---

### 6.5 用户集锦列表页

#### 我发布的集锦
每张卡片展示：集锦名称 · X 道题 · 创建于 XX月XX日 · Y 人已完成 · 平均 XXXX 分
点击 → 集锦首页（出题人视图 A）

按创建时间倒序排列。

#### 我做过的集锦
每张卡片展示：集锦名称 · 出题人昵称 · 我的得分 XXXX 分 · 完成于 XX月XX日
点击 → 集锦首页（已完成做题人视图 C）

按完成时间倒序排列。

---

### 6.6 广场（发现页）

- 展示所有用户发布的公开集锦
- v1 按创建时间倒序排列
- **卡片内容**：集锦名称 · 出题人昵称 · X 道题 · Y 人已完成
  - 无封面图（避免因图片质量参差影响整体视觉）
  - Y=0 时显示："暂无人完成，来做第一个"

---

### 6.7 分享功能

**触发位置：** 集锦首页三视图均有 [分享] 按钮。

**行为：** 点击后自动将链接+文案复制到剪贴板，展示"已复制"提示。

**三种分享文案：**

| 状态 | 文案 |
| :--- | :--- |
| 出题人 | `我出了一套地理猜谜集锦《XXX》，共 N 道题，快来挑战看看你能得多少分？[链接]` |
| 已完成做题人 | `我在《XXX》中得了 XXXX 分，快来挑战看看能不能超过我？[链接]` |
| 未完成做题人 | `我正在挑战《XXX》地理猜谜集锦，来一起玩！[链接]` |

**链接格式：** `{base_url}?collection={collection_id}`